digraph G {
rankdir=TB;
	
	invisible [style="invisible"]
	UNUSED [penwidth=3.0]
	ESTABLISHED [penwidth=3.0]
	WAIT_READY_TO_SWITCH_RTP [label="WAIT_READY_TO_SWITCH_RTP\n(wait for HO DETECT)"]
	
	ts [label="timeslot FSM",shape=box3d];
	mgwep [label="mgw endpoint\nFSM",shape=box3d];
	rtp [label="lchan_rtp\nFSM",shape=box3d];

	UNUSED -> WAIT_TS_READY [label="lchan_allocate()"]
	WAIT_TS_READY -> WAIT_ACTIV_ACK
	WAIT_ACTIV_ACK -> WAIT_RLL_RTP_ESTABLISH
	WAIT_RLL_RTP_ESTABLISH -> ESTABLISHED

	ESTABLISHED -> WAIT_RLL_RTP_RELEASED [label="LCHAN_EV_\nRELEASE"]
	WAIT_RLL_RTP_RELEASED -> WAIT_BEFORE_RF_RELEASE
	WAIT_RLL_RTP_RELEASED -> WAIT_RF_RELEASE_ACK [label="timeout",style=dashed,constraint=false]

	WAIT_BEFORE_RF_RELEASE -> WAIT_RF_RELEASE_ACK [label="T3111"]
	WAIT_RF_RELEASE_ACK -> UNUSED
	WAIT_RF_RELEASE_ACK -> WAIT_AFTER_ERROR [label="release was\ndue to error"]
	WAIT_AFTER_ERROR -> UNUSED [label="T3111+2s"]

	WAIT_TS_READY -> ts [label="TS_EV_\nLCHAN_\nREQUESTED",style=dotted,penwidth=3]
	UNUSED -> ts [label="TS_EV_\nLCHAN_\nUNUSED",style=dotted,penwidth=3]
	ts -> WAIT_TS_READY [label="LCHAN_EV_\nTS_READY",style=dotted]

	WAIT_TS_READY -> UNUSED [label="error/timeout",style=dashed,constraint=false]
	{WAIT_ACTIV_ACK,WAIT_RF_RELEASE_ACK} -> BORKEN [label="error/timeout",style=dashed]
	{WAIT_RLL_RTP_ESTABLISH} -> WAIT_RLL_RTP_RELEASED [label=error,style=dashed]

	WAIT_TS_READY -> rtp [label="TCH",style=dotted]
	rtp -> WAIT_MGW_ENDPOINT_AVAILABLE
	rtp -> WAIT_LCHAN_READY [label="re-use existing\nendpoint"]
	WAIT_MGW_ENDPOINT_AVAILABLE -> mgwep [label="CRCX",style=dotted]
	mgwep -> WAIT_MGW_ENDPOINT_AVAILABLE [label="LCHAN_RTP_EV_\nMGW_ENDPOINT_\n{AVAILABLE,ERROR}",style=dotted]
	WAIT_MGW_ENDPOINT_AVAILABLE -> WAIT_LCHAN_READY

	WAIT_ACTIV_ACK -> WAIT_LCHAN_READY [label="LCHAN_RTP_EV_LCHAN_READY",style=dotted]
	WAIT_LCHAN_READY -> WAIT_IPACC_CRCX_ACK [label="IPACC BTS"]
	WAIT_LCHAN_READY -> WAIT_READY_TO_SWITCH_RTP
	WAIT_IPACC_CRCX_ACK -> WAIT_IPACC_MDCX_ACK
	WAIT_IPACC_MDCX_ACK -> WAIT_READY_TO_SWITCH_RTP
	WAIT_READY_TO_SWITCH_RTP -> WAIT_MGW_ENDPOINT_CONFIGURED
	WAIT_MGW_ENDPOINT_CONFIGURED -> mgwep [label="MDCX",style=dotted,constraint=false]
	WAIT_MGW_ENDPOINT_CONFIGURED -> RTP_READY
	RTP_READY -> WAIT_RLL_RTP_ESTABLISH [label="LCHAN_EV_RTP_READY",style=dotted]
	RTP_READY -> RTP_ESTABLISHED [label="LCHAN_RTP_EV_ESTABLISHED"]
	term [shape=box]
	RTP_ESTABLISHED -> term [label="LCHAN_RTP_EV_RELEASE"]
	RTP_READY -> RTP_ROLLBACK [label="LCHAN_RTP_EV_ROLLBACK"]
	RTP_ROLLBACK -> term
	term -> ESTABLISHED [label="LCHAN_EV_RTP_RELEASED",style=dotted]

}
